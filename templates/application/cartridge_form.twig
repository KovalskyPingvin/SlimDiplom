{% extends 'layouts/base.twig' %}

{% block title %}Подача заявки на замену картриджа{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="/css/application/sendingstyle.css">
{% endblock %}

{% block content %}
<div class="container-form">
    <h1>Заполните форму заявки</h1>

    <form id="templateForm" method="post">
        <div>
            <label for="departmentName">Название отдела:</label>
            <input type="text" id="departmentName" name="departmentName" required>
        </div>
        <div>
            <label for="chiefName">ФИО начальника отдела (От кого?):</label>
            <input type="text" id="chiefName" name="chiefName" required>
        </div>
        <div>
            <label for="phone">Телефон:</label>
            <input type="text" id="phone" name="phone" required>
        </div>
        <div>
            <label for="printerName">Название принтера:</label>
            <input type="text" id="printerName" name="printerName" required>
        </div>
        <div>
            <label for="inventoryNumber">Инвентарный номер:</label>
            <input type="text" id="inventoryNumber" name="inventoryNumber" required>
        </div>
        <div>
            <label for="buildingNumber">Номер корпуса:</label>
            <input type="text" id="buildingNumber" name="buildingNumber" required>
        </div>
        <div>
            <label for="roomNumber">Номер кабинета:</label>
            <input type="text" id="roomNumber" name="roomNumber" required>
        </div>
        <div>
            <label for="reason">Причина:</label>
            <textarea id="reason" name="reason" required></textarea>
        </div>
        <div class="button-group">
            <button type="submit" class="button-send button-green">Отправить</button>
        </div>
    </form>
</div>

<div id="webOutput"></div>

<div id="modal-sending" class="modal-sending">
  <div class="modal-content">
    <p id="modal-sending-message"></p>
    <button onclick="closeModalSending()">Закрыть</button>
  </div>
</div>

<script>
function closeModalSending() {
    document.getElementById('modal-sending').classList.remove('active');
}

document.getElementById('templateForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = new FormData(this);

    fetch('/sending/submit', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json()) // ← Убедись, что получаем JSON
    .then(data => {
        document.getElementById('modal-sending-message').textContent = data.message;
        document.getElementById('modal-sending').classList.add('active');
        if (data.success) {
            this.reset();
        }
    })
    .catch(error => {
        console.error('Ошибка:', error);
        document.getElementById('modal-sending-message').textContent = 'Ошибка отправки заявки.';
        document.getElementById('modal-sending').classList.add('active');
    });
});
</script>

{% include 'components/notification.twig' %}
{% endblock %}