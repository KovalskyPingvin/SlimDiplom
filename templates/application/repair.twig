{% extends 'layouts/base.twig' %}

{% block title %}Заявка на ремонт техники{% endblock %}

{% block extra_css %}
<style>
    body {
        background-color: #f9f9f9;
    }
    .container-form {
        width: 500px;
        margin: 30px auto 30px;
        padding: 30px;
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
        text-align: center;
        margin-bottom: 25px;
        color: #333;
    }
    form div {
        margin-bottom: 20px;
    }
    label {
        display: block;
        font-weight: bold;
        margin-bottom: 8px;
        color: #555;
    }
    input[type="text"],
    input[type="tel"],
    textarea {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 15px;
        box-sizing: border-box;
        transition: border-color 0.3s ease;
    }
    input[type="text"]:focus,
    input[type="tel"]:focus,
    textarea:focus {
        border-color: #007BFF;
        outline: none;
    }
    textarea {
        resize: none;
        height: 120px;
    }
    .button-send {
        display: block;
        width: 100%;
        padding: 12px;
        background-color: #007BFF;
        color: #ffffff;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.1s ease;
        text-align: center;
    }
    .button-send:hover {
        background-color: #0056b3;
    }
    .button-send:active {
        transform: scale(0.98);
    }
    .button-group {
        display: flex;
        gap: 10px;
    }
    .button-group .button-send {
        flex: 1;
    }
    .button-green {
        background-color: #28a745;
    }
    .button-green:hover {
        background-color: #218838;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-form">
    <h1>Заявка на ремонт техники</h1>

    <form id="templateForm">
        <div>
            <label for="departmentHead">Ваше ФИО:</label>
            <input type="text" id="departmentHead" name="departmentHead">
        </div>
        <div>
            <label for="tel">Тел.:</label>
            <input type="tel" id="tel" name="tel">
        </div>
        <div>
            <label for="building">Номер корпуса:</label>
            <input type="text" id="building" name="building">
        </div>
        <div>
            <label for="room">Номер аудитории:</label>
            <input type="text" id="room" name="room">
        </div>
        <div>
            <label for="reason">Причина:</label>
            <textarea id="reason" name="reason"></textarea>
        </div>
        <div class="button-group">
            <button type="button" class="button-send button-green" onclick="generateDoc()">Сформировать документ</button>
        </div>
    </form>
</div>

<div id="webOutput"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
    function generateDoc() {
        const departmentHead = document.getElementById("departmentHead").value;
        const tel = document.getElementById("tel").value;
        const building = document.getElementById("building").value;
        const room = document.getElementById("room").value;
        const reason = document.getElementById("reason").value;

        // Формат даты: ДД.ММ.ГГГГ
        const now = new Date();
        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const year = now.getFullYear();
        const formattedDate = `${day}.${month}.${year}`;

        let docContent = `
          <html xmlns:o='urn:schemas-microsoft-com:office:office'
          xmlns:w='urn:schemas-microsoft-com:office:word'
          xmlns='http://www.w3.org/TR/REC-html40'>
          <head>
            <meta charset="UTF-8">
            <!--[if gte mso 9]><xml><w:WordDocument><w:View>Print</w:View><w:Zoom>100</w:Zoom></w:WordDocument></xml><![endif]-->
            <style>
                body { font-family: 'Times New Roman', serif; }
                .header-table { width: 100%; border-collapse: collapse; }
                .header-table td { font-family: 'Times New Roman', serif; vertical-align: top; padding: 0; }
                .header-left-column { width: 65%; }
                .header-right-column { width: 35%; text-align: left; line-height: 1.4; }
                .header-right-column p { margin-bottom: 0.4px; }
                .main-content { margin-bottom: 40px; font-family: 'Times New Roman', serif; }
                .presentation { text-align: center; font-weight: bold; }
                .indented-paragraph { text-indent: 30px; font-family: 'Times New Roman', serif; }
                .signature-block { margin-bottom: 20px; width: 100%; font-family: 'Times New Roman', serif; }
                .signature-item span { font-size: 0.5em; display: block; margin-bottom: 2px; }
                .signature-item hr { margin: 3px 0; border: none; border-bottom: 1px solid #000; width: 150px; text-align: center; }
            </style>
          </head>
          <body>
            <table class="header-table">
              <tr>
                <td class="header-left-column">
                </td>
                <td class="header-right-column">
                  <p>\${departmentHead}</p>
                  <p>Начальнику отдела СКСиС</p>
                  <p>___________________________</p>
                  <p>Тел.: \${tel}</p>
                </td>
              </tr>
            </table>
            <div style="clear: both;"></div>

            <div class="main-content">
              <p class="presentation">Представление</p>
              <p style="margin-bottom: 0; text-indent: 30px;">Прошу выполнить работу по ремонту технического оборудования в корпусе № \${building} в аудитории \${room}.</p>
              <p class="indented-paragraph">Причина: \${reason}.</p>
            </div>

            <div class="date">
              <p>\${formattedDate}</p>
              <br>
            </div>

            <div class="signature-block">
                <table style="width: 100%; border-collapse: collapse;">
                  <tr>
                    <td style="width: 30%; text-align: center; vertical-align: top;">
                        <hr>
                        <span style="font-size: 0.5em; text-align:center;">Должность руководителя подразделения</span>
                    </td>
                    <td style="width: 30%; text-align: center; vertical-align: top;">
                        <hr>
                        <span style="font-size: 0.5em; text-align:center;">Подпись</span>
                    </td>
                    <td style="width: 30%; text-align: center; vertical-align: top;">
                        <hr>
                        <span style="font-size: 0.5em; text-align:center;">И.О. Фамилия</span>
                    </td>
                  </tr>
                </table>
            </div>

            <div class="signature-block">
                <table style="width: 100%; border-collapse: collapse;">
                  <tr>
                    <td style="width: 30%; text-align: center; vertical-align: top;">
                        <hr>
                        <span style="font-size: 0.5em; text-align:center;">Должность материально-ответственного лица</span>
                    </td>
                    <td style="width: 30%; text-align: center; vertical-align: top;">
                        <hr>
                        <span style="font-size: 0.5em; text-align:center;">Подпись</span>
                    </td>
                    <td style="width: 30%; text-align: center; vertical-align: top;">
                        <hr>
                        <span style="font-size: 0.5em; text-align:center;">И.О. Фамилия</span>
                    </td>
                  </tr>
                </table>
            </div>
          </body>
          </html>
        `;

        // Создаём Blob с HTML-содержимым
        const blob = new Blob(['\\ufeff', docContent], {
            type: 'application/msword'
        });

        // Скачиваем файл
        saveAs(blob, "Заявка на ремонт техники.doc");
    }
</script>
{% endblock %}